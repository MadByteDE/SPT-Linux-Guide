## SPT Lutris installer v2025.1-2 ##
## This Lutris installer is using the -OFFICIAL- SPT installer
description: 'Installs the BSG Launcher & SPT for you. The game needs to be installed manually!'
notes: "You likely need to set a custom *global* wine version or the 'SPTInstaller.exe' might not work!\nPlease check out the link for further details & assistence"
credits: "https://github.com/MadByteDE/SPT-Linux-Guide"
game_slug: escape-from-tarkov
installer_slug: spt-installer-official
name: SPTarkov - Launcher
runner: wine

script:
    files:
    - eft:
        url: https://prod.escapefromtarkov.com/launcher/download
        filename: BsgLauncher.exe
    - spt-installer:
        url: https://ligma.waffle-lord.net/SPTInstaller.exe
        filename: SPTInstaller.exe
    game:
        arch: win64
        exe: drive_c/SPTarkov/SPT.Launcher.exe
        prefix: $GAMEDIR
        launch_configs:
        - exe: SPT.Server.exe
          name: SPTarkov - Server
        - exe: BsgLauncher.exe
          name: BSG Launcher
          args: --disable-software-rasterizer
          working_dir: $GAMEDIR/drive_c/Battlestate Games/BsgLauncher
    installer:
    - task:
        name: create_prefix
        overrides:
            mscoree: d
        arch: win64
    - merge:
        src: spt-installer
        dst: $GAMEDIR/drive_c/SPTarkov/
    - extract:
        description: Installing BSG Launcher ...
        dst: $GAMEDIR/drive_c/Battlestate Games/BsgLauncher/
        file: eft
        format: gog
    - task:
        app: arial times vcrun2022 dotnetdesktop6 dotnetdesktop8
        arch: win64
        description: Installing game dependencies ...
        name: winetricks
        prefix: $GAMEDIR
    - task:
        app: dotnet48
        arch: win64
        description: Installing .NET 4.8 (This can take a while ...)
        name: winetricks
        prefix: $GAMEDIR
    - task:
        description: Adding mouse focus workaround registry key ...
        name: set_regedit
        path: HKEY_CURRENT_USER\Software\Wine\X11 Driver
        key: UseTakeFocus
        value: N
    - task:
        app: win81
        arch: win64
        description: Setting windows version to Windows 8.1...
        name: winetricks
        prefix: $GAMEDIR
    - task:
        arch: win64
        description: Launching BSG Launcher (Login sometimes takes a bit ...)
        executable: $GAMEDIR/drive_c/Battlestate Games/BsgLauncher/BsgLauncher.exe
        args: --disable-software-rasterizer
        name: wineexec
        working_dir: $GAMEDIR/drive_c/Battlestate Games/BsgLauncher
    - task:
        name: winekill
    - task:
        arch: win64
        description: Launching SPTInstaller ...
        executable: $GAMEDIR/drive_c/SPTarkov/SPTInstaller.exe
        args: installpath="C:\SPTarkov"
        name: wineexec
    - task:
        name: winekill
    # Installation complete
    install_complete_text: "All done! ※\\(^o^)/※\n
                     \n
                     Quick start:\n
                     1. Launch 'SPTarkov - Server'\n
                     2. Launch 'SPTarkov - Launcher'\n
                     3. Create a new profile & play\n
                     \n
                     For the latest updates & mods, visit:\n
                     https://hub.sp-tarkov.com/\n
                     \n
                     Have fun! ('-')7"
    system:
        env:
            PROTON_VERB: run
            # Possible workarounds for dotnet package issues (SPT Launcher)
            DOTNET_BUNDLE_EXTRACT_BASE_DIR:
            DOTNET_ROOT: 
        # Without terminal mode the server won't run!
        terminal: true
    wine:
        overrides:
            winhttp: n,b
            icu: d

slug: sptarkov
version: sptinstaller-latest
year: 2017