## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
##      SPTarkov Lutris installer script
##                 v2025.10-4
## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

# NOTE: This Lutris installer is using the -OFFICIAL- windows installer.

description: 'Installs SPTarkov for you; EFT needs to be installed manually!'
notes: "Make sure the main game is installed inside the BSG Launcher before installing SPTarkov.\nCheck out the link for further details & assistance!"
credits: "https://github.com/MadByteDE/SPT-Linux-Guide"
game_slug: sptarkov
installer_slug: sptarkov-official-installer
name: SPTarkov - Launcher
runner: wine
script:
    files:
    - spt-installer:
        url: https://ligma.waffle-lord.net/SPTInstaller.exe
        filename: SPTInstaller.exe
    - dotnet-windows:
        url: https://builds.dotnet.microsoft.com/dotnet/WindowsDesktop/9.0.9/windowsdesktop-runtime-9.0.9-win-x64.exe
        filename: dotnetcore-runtime.exe
    - aspnet-windows:
        url: https://builds.dotnet.microsoft.com/dotnet/aspnetcore/Runtime/9.0.9/aspnetcore-runtime-9.0.9-win-x64.exe
        filename: aspnetcore-runtime.exe
    - launch-server-sh:
        url: https://raw.githubusercontent.com/MadByteDE/SPT-Linux-Guide/main/scripts/launch-server.sh
        filename: launch-server.sh
    game:
        arch: win64
        exe: drive_c/SPTarkov/SPT.Launcher.exe
        prefix: $GAMEDIR
        working_dir: $GAMEDIR/drive_c/SPTarkov/SPT
    requires: escape-from-tarkov
    installer:

    # Prepare the wine prefix
    - task:
        app: arial times dotnetdesktop6 dotnetdesktop8
        arch: win64
        description: Installing game dependencies ...
        name: winetricks
        prefix: $GAMEDIR

    # Install .NET Desktop Runtime 9.0
    - task:
        arch: win64
        description: Installing .NET Desktop Runtime 9.0 ...
        executable: dotnet-windows
        args: /q
        name: wineexec

    # Install ASP.NET Desktop Runtime 9.0
    - task:
        arch: win64
        description: Installing ASP.NET Runtime 9.0 ...
        executable: aspnet-windows
        args: /q
        name: wineexec

    - task:
        app: win10
        arch: win64
        description: Setting windows version to Windows 10...
        name: winetricks 
        prefix: $GAMEDIR

    # Install SPT using the windows installer
    - task:
        arch: win64
        description: Launching SPTInstaller ...
        executable: spt-installer
        args: installpath="C:\SPTarkov"
        name: wineexec
    - task:
        name: winekill

    # Symlink the SPT.Launcher.exe to the root game directory
    - execute:
        command: cd "$GAMEDIR/drive_c/SPTarkov" && ln -s "./SPT/SPT.Launcher.exe" "./SPT.Launcher.exe"
        description: Creating symbolic link for the SPT.Launcher.exe

    # Set the native SPT server to be executable
    - execute:
        command: chmod +x "$GAMEDIR/drive_c/SPTarkov/SPT/SPT.Server.Linux"
        description: Setting 'SPT.Server.Linux' to be executable

    # Used as pre-launch script in Lutris to launch the native server automatically with
    # the 'SPTarkov - Launcher' shortcut
    # Source - https://github.com/MadByteDE/SPT-Linux-Guide/main/scripts/launch-server.sh
    - merge:
        src: launch-server-sh
        dst: $GAMEDIR/drive_c/SPTarkov
    - chmodx: $GAMEDIR/drive_c/SPTarkov/launch-server.sh

    # Installation complete
    install_complete_text: "All done! ※\\(^o^)/※\n
                     \n
                     Quick start:\n
                     1. Launch 'SPTarkov - Launcher'\n
                     2. Wait for the server to show 'Server has started, happy playing'\n
                     3. Connect, create a new profile & play\n
                     \n
                     For the latest updates & mods, visit:\n
                     https://forge.sp-tarkov.com/\n
                     \n
                     Have fun! ('-')7"
                     
    system:
        prelaunch_command: $GAMEDIR/drive_c/SPTarkov/launch-server.sh
        env:
            PROTON_VERB: run
            DOTNET_BUNDLE_EXTRACT_BASE_DIR:
            DOTNET_ROOT: 
    wine:
        overrides:
            winhttp: n,b
            # icu: d

slug: sptarkov
version: sptarkov-official-latest
year: 2017